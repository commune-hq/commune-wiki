---
---
<header class="commune-header">
  <div class="wrap">
    <a href="/" class="brand-section">
      <img src="/avatar.jpg" alt="Devon" class="avatar" />
      <span class="brand">Devon</span>
    </a>
    <div class="controls">
      <button id="theme-toggle" class="theme-btn" aria-label="Toggle theme">
        <span class="sun">‚òÄÔ∏è</span>
        <span class="moon">üåô</span>
      </button>
      <button class="search-btn" aria-label="Search (‚åòK)" onclick="window.dispatchEvent(new CustomEvent('commune:openSearch'))">
        <span class="search-icon">üîç</span>
        <span class="search-text">Search</span><kbd>‚åòK</kbd>
      </button>
    </div>
  </div>
</header>

<style>
  .commune-header{
    position:sticky;
    top:0;
    background:var(--c-bg);
    backdrop-filter:saturate(120%) blur(12px);
    border-bottom:1px solid var(--c-border);
    z-index:var(--z-header);
    box-shadow:var(--c-shadow-sm);
  }
  .wrap{
    display:flex;
    align-items:center;
    gap:1rem;
    justify-content:space-between;
    padding:1rem 1.25rem;
    max-width:clamp(480px, 45vw, 700px);
    margin:0 auto;
  }
  .brand-section{
    display:flex;
    align-items:center;
    gap:.75rem;
    text-decoration:none;
    color:inherit;
  }
  .avatar{
    width:2.5rem;
    height:2.5rem;
    border-radius:50%;
    object-fit:cover;
    border:2px solid var(--c-border);
    transition:border-color 0.15s ease;
  }
  .avatar:hover{
    border-color:var(--c-accent);
  }
  .controls{
    display:flex;
    align-items:center;
    gap:.75rem;
  }
  .brand{
    font-weight:700;
    font-size:1.15rem;
    letter-spacing:.3px;
    color:var(--c-text);
    cursor:pointer;
    transition:color 0.15s ease;
  }

  /* Tablet and below: adjust brand text size and header padding */
  @media (max-width: 768px) {
    .wrap {
      padding:1rem 1.5rem;
    }
    .brand {
      font-size:1.1rem;
      font-weight:600;
    }
  }
  .brand:hover{
    color:var(--c-accent);
  }
  nav{
    display:flex;
    gap:1.25rem;
  }
  nav a{
    color:var(--c-text);
    font-weight:500;
    cursor:pointer;
    transition:color 0.15s ease;
  }
  nav a:hover{
    color:var(--c-accent);
  }
  .theme-btn{
    display:flex;
    align-items:center;
    justify-content:center;
    width:2.5rem;
    height:2.5rem;
    border:1.5px solid var(--c-border);
    background:var(--c-bg-soft);
    border-radius:var(--c-radius-md);
    cursor:pointer;
    transition:all 0.15s ease;
    font-size:1.2rem;
    position:relative;
  }
  .theme-btn:hover{
    border-color:var(--c-accent);
    transform:rotate(15deg);
  }
  
  /* Mobile: prevent rotate transform issues on touch */
  @media (max-width: 768px) {
    .theme-btn:hover {
      transform:none;
    }
    .theme-btn:active {
      transform:scale(0.95);
      transition:transform 0.1s ease;
    }
  }
  .theme-btn .sun,
  .theme-btn .moon{
    position:absolute;
    transition:opacity 0.2s ease, transform 0.2s ease;
  }
  :root[data-theme="light"] .theme-btn .sun{
    opacity:1;
    transform:rotate(0deg);
  }
  :root[data-theme="light"] .theme-btn .moon{
    opacity:0;
    transform:rotate(180deg);
  }
  :root[data-theme="dark"] .theme-btn .sun{
    opacity:0;
    transform:rotate(180deg);
  }
  :root[data-theme="dark"] .theme-btn .moon{
    opacity:1;
    transform:rotate(0deg);
  }
  .search-btn{
    display:flex;
    align-items:center;
    gap:.6rem;
    border:1.5px solid var(--c-border);
    background:var(--c-bg-soft);
    padding:.5rem .8rem;
    border-radius:var(--c-radius-md);
    cursor:pointer;
    transition:all 0.15s ease;
  }
  .search-btn:hover{
    border-color:var(--c-accent);
    background:var(--c-bg);
  }
  .search-btn span{
    color:var(--c-text-muted);
    font-size:.95rem;
  }
  /* Hide search emoji on desktop */
  .search-btn .search-icon {
    display:none;
  }
  kbd{
    font-size:.75rem;
    color:var(--c-text-muted);
    border:1px solid var(--c-border);
    background:var(--c-bg);
    padding:.2rem .4rem;
    border-radius:var(--c-radius-sm);
  }

  /* Mobile: hide Command-K text and search text, show only icon */
  @media (max-width: 768px) {
    .search-btn kbd,
    .search-btn .search-text {
      display:none;
    }
    .search-btn .search-icon {
      display:block;
      font-size:1.1rem;
    }
    .search-btn {
      padding:.6rem;
      min-width:2.5rem;
      justify-content:center;
    }
    .avatar {
      width:2.2rem;
      height:2.2rem;
    }
    .controls {
      gap:.5rem;
    }
  }
</style>

<script is:inline>
  // Theme toggle
  (function initTheme(){
    const toggle = document.getElementById('theme-toggle');
    const root = document.documentElement;
    
    // Get saved theme or default to system preference
    const savedTheme = localStorage.getItem('commune-theme');
    const systemPrefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
    const initialTheme = savedTheme || (systemPrefersDark ? 'dark' : 'light');
    
    root.setAttribute('data-theme', initialTheme);
    
    toggle?.addEventListener('click', () => {
      const currentTheme = root.getAttribute('data-theme');
      const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
      root.setAttribute('data-theme', newTheme);
      localStorage.setItem('commune-theme', newTheme);
    });
  })();

  // cmd/ctrl-k opens modal
  addEventListener('keydown', (e) => {
    const mac = navigator.platform.toUpperCase().includes('MAC');
    if ((mac ? e.metaKey : e.ctrlKey) && e.key.toLowerCase() === 'k') {
      e.preventDefault();
      dispatchEvent(new CustomEvent('commune:openSearch'));
    }
  });
</script>
