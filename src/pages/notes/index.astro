---
import { getCollection } from 'astro:content';
import Header from '../../components/Header.astro';
import SearchModal from '../../components/SearchModal.astro';

const notes = await getCollection('notes');
const list = notes
  .filter((n: any) => (n.data.visibility ?? 'private') === 'public')
  .sort((a: any, b: any) => (new Date(b.data.updated ?? 0)).valueOf() - (new Date(a.data.updated ?? 0)).valueOf());
---
<html><head><meta charset="utf-8"><title>Notes • Commune</title><meta name="viewport" content="width=device-width, initial-scale=1"/></head>
<body>
  <Header />
  <SearchModal />
  <main class="wrap">
    <h1>Notes</h1>
    <p class="hint">Press <kbd>⌘K</kbd> to search across notes & docs.</p>
    <ul class="grid">
      {list.map((n:any) => (
        <li><a href={`/notes/${n.slug}/`}>{n.data.title ?? n.slug}</a>
          <div class="meta">{(n.data.tags ?? []).slice(0,3).join(' • ')}</div>
        </li>
      ))}
    </ul>
  </main>
</body></html>

<style>
  .wrap{max-width:1100px;margin:1.2rem auto;padding:0 1rem 4rem}
  .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:14px;list-style:none;padding:0}
  .grid li{border:1px solid rgba(0,0,0,.08);border-radius:12px;padding:14px}
  .meta{opacity:.65;font-size:.85rem;margin-top:.25rem}
  kbd{font-size:.8rem;border:1px solid rgba(0,0,0,.2);padding:.1rem .3rem;border-radius:.35rem}
</style>
